<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Four Phases. One Vision.</title>
<style>
  :root{
    --navy:#0b1b2b;
    --navy-2:#0f2740;
    --ink:#e8eef6;
    --muted:#9fb1c9;
    --accent:#e93b2f; /* red icons/accent */
    --ok:#41d695;
    --warn:#ffcc66;
    --locked: blur(3px) saturate(70%);
    --card:#10263d;
    --card-2:#173450;
    --ring: 0 0 0 2px rgba(255,255,255,.07), 0 10px 30px rgba(0,0,0,.35);
    --radius:18px;
    --radius-sm:12px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family: ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;
    color:var(--ink); background:#07111d;
    background-image:
      radial-gradient(1200px 500px at 50% -20%, rgba(33,79,132,.4), transparent 60%),
      linear-gradient(to bottom, #09182a, #07111d 40%),
      url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="1440" height="700" viewBox="0 0 1440 700"><defs><linearGradient id="g" x1="0" y1="0" x2="0" y2="1"><stop stop-color="%230b1b2b" offset="0"/><stop stop-color="%2308182a" offset="1"/></linearGradient></defs><rect width="1440" height="700" fill="url(%23g)"/><path d="M0 520 L200 420 L360 500 L560 360 L720 480 L900 400 L1100 520 L1300 450 L1440 520 L1440 700 L0 700 Z" fill="%23132d49"/><path d="M0 560 L180 480 L360 540 L520 440 L680 520 L860 470 L1040 560 L1240 520 L1440 560 L1440 700 L0 700 Z" fill="%171f37" opacity="0.8"/></svg>');
    background-size: cover;
    background-attachment: fixed;
  }
  header{
    position:sticky; top:0; z-index:10;
    background:linear-gradient(to bottom, rgba(7,17,29,.9), rgba(7,17,29,.65));
    backdrop-filter:saturate(120%) blur(10px);
    border-bottom:1px solid rgba(255,255,255,.06);
  }
  .wrap{max-width:1100px;margin:0 auto;padding:18px 20px}
  .brand{display:flex;align-items:center;gap:12px}
  .logo{
    width:38px;height:38px;border-radius:10px;
    background: radial-gradient(circle at 30% 30%, #ff6b6b, #e93b2f 60%, #7a1212 100%);
    box-shadow: var(--ring);
  }
  h1{margin:0;font-size:20px;letter-spacing:.3px}
  .tag{color:var(--muted);font-size:13px}

  /* Phase bubbles row */
  .phases{
    display:grid;grid-template-columns:repeat(4,1fr);
    gap:14px;margin:18px 0 8px;
  }
  .bubble{
    position:relative; padding:14px 12px; border-radius:16px;
    background:linear-gradient(180deg,var(--card),var(--card-2));
    border:1px solid rgba(255,255,255,.08);
    box-shadow: var(--ring);
    cursor:pointer; user-select:none; transition:transform .12s ease, border-color .2s;
  }
  .bubble:hover{transform:translateY(-2px); border-color:rgba(255,255,255,.14)}
  .bubble.locked{cursor:not-allowed; opacity:.6}
  .bubble .top{display:flex;align-items:center;gap:10px}
  .bubble .ico{font-size:18px; color:var(--accent)}
  .bubble .name{font-weight:700; font-size:14px}
  .bubble .meta{color:var(--muted);font-size:12px;margin-top:6px;display:flex;justify-content:space-between;gap:8px}
  .badge{
    padding:2px 8px;border-radius:999px;font-size:11px;border:1px solid rgba(255,255,255,.12);
    background:rgba(255,255,255,.04);
  }
  .badge.ok{border-color:rgba(65,214,149,.35)}
  .badge.warn{border-color:rgba(255,204,102,.35)}
  .bar{
    height:7px;border-radius:6px; background:rgba(255,255,255,.08); margin-top:10px; overflow:hidden
  }
  .bar>span{display:block;height:100%;background:linear-gradient(90deg,var(--accent),#ff7b73);width:0%}

  /* Panels */
  .panel{margin-top:14px;border-radius:var(--radius);overflow:hidden;border:1px solid rgba(255,255,255,.08)}
  .panel .head{
    background:linear-gradient(180deg,var(--card-2),#0e2338);
    padding:14px 16px; display:flex; align-items:center; justify-content:space-between; gap:10px;
  }
  .panel .head h2{margin:0;font-size:16px}
  .panel .body{background:rgba(9,24,42,.7); padding:16px; display:none}
  .panel.open .body{display:block}
  .subgrid{display:grid;grid-template-columns:1.2fr .8fr; gap:16px}
  .card{
    background:linear-gradient(180deg,var(--card),var(--card-2));
    border:1px solid rgba(255,255,255,.08); border-radius:var(--radius-sm); padding:14px; box-shadow:var(--ring)
  }
  .card h3{margin:0 0 8px 0; font-size:14px}
  .timeline{display:flex;flex-direction:column;gap:10px}
  .step{display:flex;gap:10px;align-items:flex-start}
  .dot{width:10px;height:10px;border-radius:999px;background:var(--accent);margin-top:6px;box-shadow:0 0 0 3px rgba(233,59,47,.25)}
  .step .txt{font-size:13px;color:#d8e5f7}

  /* Checklist */
  .list{display:flex;flex-direction:column;gap:10px}
  label.chk{
    display:flex; align-items:flex-start; gap:10px; font-size:13px; line-height:1.3;
    padding:8px 10px; border-radius:10px; background:rgba(255,255,255,.03);
    border:1px solid rgba(255,255,255,.07);
  }
  .chk input{transform:translateY(2px); accent-color:var(--accent)}
  .actions{display:flex;flex-wrap:wrap; gap:8px; margin-top:12px}
  .btn{
    background:linear-gradient(180deg,#1a3350,#12283f);
    border:1px solid rgba(255,255,255,.12);
    color:var(--ink); font-weight:600; padding:10px 14px; border-radius:12px; cursor:pointer;
  }
  .btn.secondary{background:transparent}
  .btn[disabled]{opacity:.5;cursor:not-allowed}

  /* Lock/blur */
  .blurred{filter:var(--locked); position:relative}
  .locked-note{
    position:absolute; inset:auto 12px 12px auto; z-index:2;
    background:rgba(7,17,29,.85); border:1px dashed rgba(255,255,255,.25);
    color:var(--muted); padding:6px 10px; border-radius:10px; font-size:12px;
  }

  footer{
    margin:28px 0 40px; color:var(--muted); font-size:12px; text-align:center
  }

  @media (max-width:900px){
    .subgrid{grid-template-columns:1fr}
    .phases{grid-template-columns:1fr 1fr}
  }
  @media (max-width:520px){
    .phases{grid-template-columns:1fr}
  }






.monday-link {
  font-size: 12px;
  color: var(--muted);
  text-decoration: none;
}
.monday-link:hover {
  text-decoration: underline;
  color: var(--accent);
}


/* Header layout */
.header-row{display:flex;align-items:center;justify-content:space-between}
.brand{display:flex;align-items:center;gap:12px}
.brand-logo{width:40px;height:40px;border-radius:10px;box-shadow:var(--ring)}
.site-title{margin:0;font-size:18px;letter-spacing:.4px}
.header-actions{display:flex;align-items:center;gap:12px}
.hdr-link{font-size:14px;color:var(--ink);opacity:.9;text-decoration:none}
.hdr-link:hover{opacity:1;text-decoration:underline;color:var(--accent)}

/* Hero */
.hero{display:flex;flex-direction:column;align-items:center;text-align:center;margin:28px 0 12px}
.hero-title{font-size:26px; margin:0 0 6px 0; letter-spacing:.6px}
.hero-quote{color:var(--muted); font-size:14px; margin:0}


nav a{color:var(--ink);opacity:.9;text-decoration:none;margin-left:14px}
nav a:hover{opacity:1;text-decoration:underline;color:var(--accent)}


.header-nav{display:flex;align-items:center;gap:18px}
.header-nav a{color:var(--ink);opacity:.9;text-decoration:none;font-size:14px;font-weight:600}
.header-nav a:hover{opacity:1;text-decoration:underline;color:var(--accent)}


.header-nav{display:flex;align-items:center;gap:18px}
.header-nav a{color:var(--ink);opacity:.9;text-decoration:none;font-size:14px;font-weight:600;position:relative;overflow:hidden}
.header-nav a::after{content:'';position:absolute;left:0;bottom:-2px;width:100%;height:2px;background:var(--accent);transform:translateX(-100%);transition:transform .25s ease}
.header-nav a:hover{opacity:1;color:var(--accent)}
.header-nav a:hover::after{transform:translateX(0)}


/* Right-side dropdown menu */
.header-row{display:flex;align-items:center;justify-content:space-between}
.header-menu{position:relative;margin-left:auto}
.header-menu > summary{
  list-style:none; cursor:pointer; font-weight:700; font-size:14px;
  color:var(--ink); opacity:.95; padding:8px 12px; border-radius:10px;
  border:1px solid rgba(255,255,255,.12);
  background:linear-gradient(180deg,#1a3350,#12283f);
}
.header-menu[open] > summary{opacity:1; outline:none}
.header-menu .menu-items{
  position:absolute; right:0; top:calc(100% + 6px); min-width:210px; z-index:20;
  background:linear-gradient(180deg,var(--card),var(--card-2));
  border:1px solid rgba(255,255,255,.12); border-radius:12px; box-shadow:var(--ring);
  padding:8px;
}
.header-menu .menu-items a{
  display:block; padding:10px 10px; border-radius:8px; text-decoration:none;
  color:var(--ink); font-size:14px; font-weight:600; position:relative; overflow:hidden;
}
.header-menu .menu-items a:hover{background:rgba(255,255,255,.06); color:var(--accent)}
/* close when clicking outside (JS added) */


.menu-icon{width:20px;height:14px;display:inline-block;position:relative}
.menu-icon::before,
.menu-icon::after,
.menu-icon div{content:'';position:absolute;left:0;width:100%;height:3px;background:var(--ink);border-radius:2px}
.menu-icon::before{top:0}
.menu-icon::after{bottom:0}
.menu-icon div{top:50%;transform:translateY(-50%)}


.group{border:1px solid rgba(255,255,255,.07);border-radius:12px;padding:10px;margin-bottom:10px;background:rgba(255,255,255,.03)}
.group-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:6px}
.group-title{font-weight:700;font-size:13px}
.group-meta{font-size:12px;color:var(--muted)}
label.chk.sub{background:transparent;border:1px dashed rgba(255,255,255,.1)}


/* Blurred background photo layer */
.bg-blur{
  position:fixed; inset:0; z-index:-2 !important;
  background-image:url('bg.png');
  background-size:cover; background-position:center;
  filter:blur(12px);
  transform:scale(1.04); /* avoid edge blur crop */
}
/* Make surface elements translucent so background shows through */
.panel .head{background:rgba(20,35,55,.55)}
.panel .body{background:rgba(12,26,44,.45)}
.card{background:rgba(16,38,61,.45)}
.bubble{background:rgba(16,38,61,.45)}
header{background:linear-gradient(to bottom, rgba(7,17,29,.75), rgba(7,17,29,.35))}


/* Side drawer menu (right) */
.side-toggle{
  position:fixed; right:14px; top:14px; z-index:30;
  background:transparent; border:none; padding:6px; cursor:pointer;
}
.side-toggle .arrow, .side-toggle .arrow::before, .side-toggle .arrow::after{
  content:''; display:block; width:14px; height:2px; background:var(--ink); border-radius:2px;
  transition:transform .25s ease, opacity .25s ease;
}
.side-toggle .arrow::before{margin-top:4px}
.side-toggle .arrow::after{margin-top:4px}
/* When drawer open, morph into X */
.side-open .side-toggle .arrow{transform:rotate(45deg)}
.side-open .side-toggle .arrow::before{opacity:0}
.side-open .side-toggle .arrow::after{transform:rotate(90deg) translate(-4px, -4px)}

.side-drawer{
  position:fixed; top:0; right:0; height:100%; width:240px; z-index:25;
  background:rgba(10,22,38,.75); backdrop-filter:blur(8px);
  border-left:1px solid rgba(255,255,255,.12);
  transform:translateX(100%); transition:transform .25s ease;
  padding:18px 14px;
}
.side-open .side-drawer{transform:translateX(0)}
.side-drawer nav{display:flex;flex-direction:column;gap:8px;margin-top:40px}
.side-drawer nav a{
  color:var(--ink); text-decoration:none; font-weight:700; padding:10px 12px; border-radius:10px;
  border:1px solid rgba(255,255,255,.08); background:rgba(255,255,255,.04);
}
.side-drawer nav a:hover{color:var(--accent); background:rgba(255,255,255,.08)}


/* Dark overlay on top of background for better text contrast */
.bg-overlay{position:fixed; inset:0; z-index:-2 !important; background:linear-gradient(to bottom right, rgba(0,0,0,.55), rgba(0,0,0,.35));}


.bg-blur, .bg-overlay{
  position:fixed; inset:0; z-index:-2 !important;
}

</style>
</head>
<body>
  <div class="bg-blur" aria-hidden="true"></div>
  <div class="bg-overlay" aria-hidden="true"></div>
  <header>
    
    <div class="wrap header-row">
      <div class="brand">
        <img src="logo.png" alt="MBS LLC logo" class="brand-logo" />
        <div>
          <h1 class="site-title">MBS LLC</h1>
        </div>
      </div>
      
    
    
      
    </div>

</header>
<aside class="side-drawer" aria-hidden="true"><nav>
<a href="index.html">Home</a>
<a href="services.html">Services</a>
<a href="#">Community</a>
<a href="#">Real Estate</a>
<a href="https://monday.com" target="_blank" rel="noopener">Monday.com</a>
<a href="https://quickbooks.intuit.com" target="_blank" rel="noopener">QuickBooks</a>
</nav></aside>


  


  <main class="wrap" id="app">

    <section class="hero">
      <h2 class="hero-title">FOUR PHASES. One Vision.</h2>
      <p class="hero-quote" id="dailyQuote"></p>
    </section>


    <!-- Phase bubbles (built by JS) -->
    <section class="phases" id="bubbleRow" aria-label="Phase navigation"></section>

    <!-- Panels (built by JS) -->
    <section id="panels"></section>

    <div class="actions">
      <button class="btn" id="resetBtn" title="Clear all progress">Reset progress</button>
      
    </div>

    <footer>Version 3.3</footer>
  </main>

<script>

// Daily quote
const QUOTES = [
  "Discipline compounds — tiny wins, big outcomes.",
  "Systems first. Scale next.",
  "Move fast, fix alignment, protect quality.",
  "Every invoice tells a story — make it a good one.",
  "Clarity beats complexity. Ship the next block."
];
(function setDailyQuote(){
  try {
    const el = document.getElementById("dailyQuote");
    const dayIndex = Math.floor(Date.now() / (1000*60*60*24)) % QUOTES.length;
    if (el) el.textContent = QUOTES[dayIndex];
  } catch(_) {}
})();


const PHASES = [
  {
    id: 1, name: "Phase 1 — Foundation", icon:"📍",
    timeline: [
      "Define vision & financial targets",
      "Legal + brand + web foundation",
      "Pricing, deposits, and templates finalized"
    ],
    tasks: [
      { label:"Vision & Targets",
        subs:[
          "Write 1‑pager mission + 3 KPIs (MTD revenue, AOV, on‑time %)",
          "Set 12‑month and 3‑year revenue targets",
          "Document weekly operating cadence"
        ]
      },
      { label:"Legal, Banking, Tools",
        subs:[
          "Confirm LLC + EIN on file",
          "Business bank + payout routing verified",
          "QuickBooks company setup"
        ]
      },
      { label:"Brand & Web",
        subs:[
          "Upload final logo (header)",
          "Publish phases home + services metrics",
          "Footer versioning + changelog"
        ]
      },
      { label:"Pricing & Deposits",
        subs:[
          "Lock base rates + markup + tech payout",
          "20% deposit policy written",
          "Deposit + invoice templates created"
        ]
      },
      { label:"Core Services Catalog",
        subs:[
          "TV Mounting SKUs (sizes, add‑ons)",
          "Assembly SKUs (dressers, beds, tables)",
          "Full Service & Repairs list"
        ]
      },
      { label:"Comms Templates",
        subs:[
          "Appointment confirmation (no reschedule ask)",
          "Deposit link message with amount",
          "Missing payment follow‑up (short version)"
        ]
      },
      { label:"QA Guardrails",
        subs:[
          "Layout misalignment checklist",
          "Pre‑release visual diff check",
          "Rollback plan noted"
        ]
      }
    ]
  },
  {
    id: 2, name: "Phase 2 — Systems", icon:"🛠️",
    timeline: [
      "Automate intake → quote → invoice",
      "Team dashboards & availability",
      "Calendar + routines + wrap‑ups"
    ],
    tasks: [
      { label:"Intake → Quote",
        subs:[
          "Square/booking form with required photos",
          "Auto price estimate rules (by SKU)",
          "Quote → deposit link handoff"
        ]
      },
      { label:"Job Execution",
        subs:[
          "Pre‑job checklist (tools, parts)",
          "On‑site checklist (photos, notes)",
          "Post‑job wrap‑up (sign‑off, upsell)"
        ]
      },
      { label:"Payouts & Costs",
        subs:[
          "Tech payout calc (80% example)",
          "Mileage/parts tracking",
          "Weekly payout summary"
        ]
      },
      { label:"Dashboards",
        subs:[
          "Availability board",
          "Jobs pipeline (New → Scheduled → Done)",
          "Payouts view + export CSV"
        ]
      },
      { label:"Calendar & Routine",
        subs:[
          "30‑year routine seeded",
          "Daily blocks (ops, jobs, admin)",
          "Holidays + PTO policy"
        ]
      },
      { label:"Analytics",
        subs:[
          "Tiles: Bookings, AOV, Time, Deposit Rate",
          "Charts: Bookings & Revenue (12w)",
          "Data reset & local persistence"
        ]
      },
      { label:"Comms Automations",
        subs:[
          "Auto confirmation on book",
          "Reminder 24h before job",
          "Thank‑you + review ask"
        ]
      }
    ]
  },
  {
    id: 3, name: "Phase 3 — Scale", icon:"📈",
    timeline: [
      "Region expansion playbook",
      "Partnerships & referrals",
      "Marketing engine (SEO + ads)"
    ],
    tasks: [
      { label:"Region Playbook",
        subs:[
          "Price grid by region (SF/East/South/North)",
          "SLAs (response, arrival windows)",
          "Transfer template for region changes"
        ]
      },
      { label:"Partnerships",
        subs:[
          "Outreach list (property mgmt, realtors, designers)",
          "Email script + one‑pager",
          "Partner tracking sheet"
        ]
      },
      { label:"Referrals & Loyalty",
        subs:[
          "Referral offer (credit/% off)",
          "Repeat customer perks",
          "Tracking & payouts"
        ]
      },
      { label:"SEO & Content",
        subs:[
          "30‑day content calendar (services + city pages)",
          "Before/after galleries",
          "Reviews & testimonials module"
        ]
      },
      { label:"Ads",
        subs:[
          "Google LSAs / Search campaign",
          "Geo‑target & negative keywords",
          "Weekly optimization ritual"
        ]
      },
      { label:"Ops QA",
        subs:[
          "Regression guardrails checklist",
          "Staging → prod release path",
          "Incident log + postmortem template"
        ]
      }
    ]
  },
  {
    id: 4, name: "Phase 4 — Enterprise", icon:"🏔️",
    timeline: [
      "Enterprise SLAs & account mgmt",
      "Franchise/affiliate exploration",
      "Investment & diversification"
    ],
    tasks: [
      { label:"Account Management",
        subs:[
          "Named AM role & playbook",
          "Quarterly business review deck",
          "Escalation path & SLAs"
        ]
      },
      { label:"Tiered SLAs & Pricing",
        subs:[
          "Gold/Silver/Bronze definition",
          "Response/repair time targets",
          "Pricing sheets per tier"
        ]
      },
      { label:"Franchise/Affiliate",
        subs:[
          "Territory rules",
          "Onboarding & training pack",
          "Brand & quality guidelines"
        ]
      },
      { label:"Investor Materials",
        subs:[
          "One‑pager + pitch deck",
          "Metrics snapshot (MTD/YTD)",
          "Use of funds plan"
        ]
      },
      { label:"Strategy Reviews",
        subs:[
          "Quarterly strategy ritual",
          "Annual plan refresh",
          "Risk register maintenance"
        ]
      }
    ]
  }
];



// === Detailed checklist logic (nested subtasks) ===
const KEY = "mbs_phase_progress_v28"; // new key to avoid conflicts with earlier schema
const state = JSON.parse(localStorage.getItem(KEY) || "{}"); // { phaseId: { "Task Label": [true,false,...] } }

function save(){ localStorage.setItem(KEY, JSON.stringify(state)); }

function leafCount(phase){
  // total leaf subtasks
  return phase.tasks.reduce((sum,t)=> sum + (t.subs ? t.subs.length : 1), 0);
}
function leafDone(phase, pid){
  let done=0;
  phase.tasks.forEach(t=>{
    if(t.subs && t.subs.length){
      const arr = state[pid]?.[t.label] || Array(t.subs.length).fill(false);
      done += arr.filter(Boolean).length;
    }else{
      const v = state[pid]?.[t.label]?.[0] || false;
      done += v ? 1 : 0;
    }
  });
  return done;
}
function phaseProgress(pid){
  const phase = PHASES.find(p=>p.id===pid);
  const total = leafCount(phase);
  const done = leafDone(phase, pid);
  const pct = total ? Math.round(done/total*100) : 0;
  return {done,total,pct};
}
function prevComplete(pid){
  if(pid===1) return true;
  const prev = phaseProgress(pid-1);
  return prev.pct===100;
}

function renderBubbles(){
  const row = document.getElementById("bubbleRow");
  row.innerHTML = "";
  PHASES.forEach(p=>{
    const {pct, done, total} = (()=>{ const v=phaseProgress(p.id); return {pct:v.pct, done:v.done, total:v.total}; })();
    const locked = !prevComplete(p.id);
    const el = document.createElement("button");
    el.className = "bubble"+(locked?" locked":"");
    el.setAttribute("data-phase", p.id);
    el.setAttribute("aria-disabled", locked? "true":"false");
    el.innerHTML = `
      <div class="top">
        <div class="ico" aria-hidden="true">${p.icon}</div>
        <div>
          <div class="name">${p.name}</div>
          <div class="meta">
            <span class="badge ${pct===100?"ok": pct>=50?"warn":""}">${pct}% · ${done}/${total}</span>
            <span>${locked? "Locked":"Open"}</span>
          </div>
        </div>
      </div>
      <div class="bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="${pct}">
        <span style="width:${pct}%"></span>
      </div>
    `;
    el.addEventListener("click", ()=>{
      if(!prevComplete(p.id)) return;
      openPanel(p.id, true);
      document.getElementById(`panel-${p.id}`).scrollIntoView({behavior:"smooth", block:"start"});
    });
    row.appendChild(el);
  });
}


function renderPanels(){
  const container = document.getElementById("panels");
  container.innerHTML = "";
  PHASES.forEach(p=>{
    const locked = !prevComplete(p.id);
    const panel = document.createElement("section");
    panel.className = "panel"+(p.id===1? " open":"");
    panel.id = `panel-${p.id}`;
    const bodyClass = "body"+(locked? " blurred":"");
    panel.innerHTML = `
      <div class="head">
        <h2> ${p.icon} ${p.name}</h2>
        <div>
          <button class="btn secondary" data-toggle="${p.id}">Collapse/Expand</button>
        </div>
      </div>
      <div class="${bodyClass}">
        ${locked? `<div class="locked-note">Locked until Phase ${p.id-1} is 100%</div>`:""}
        <div class="subgrid">
          <div class="card">
            <h3>Timeline</h3>
            <div class="timeline">
              ${p.timeline.map(t=>`
                <div class="step">
                  <div class="dot"></div>
                  <div class="txt">${t}</div>
                </div>`).join("")}
            </div>
          </div>
          <div class="card">
            <h3>Checklist</h3>
            <div class="list" id="list-${p.id}">
              ${p.tasks.map((t)=>{
                const subs = t.subs && t.subs.length ? t.subs : [t.label];
                const arr = (state[p.id]?.[t.label]) || Array(subs.length).fill(false);
                const done = arr.filter(Boolean).length;
                const total = subs.length;
                const pct = Math.round(done/total*100);
                const bar = `<div class="bar" style="margin-top:6px"><span style="width:${pct}%"></span></div>`;
                const subHtml = subs.map((s,i)=>{
                  const checked = arr[i] ? "checked" : "";
                  return `<label class="chk sub">
                    <input type="checkbox" data-p="${p.id}" data-task="${t.label}" data-i="${i}" ${checked}/>
                    <span>${s}</span>
                  </label>`;
                }).join("");
                return `<div class="group">
                  <div class="group-head">
                    <div class="group-title">${t.label}</div>
                    <div class="group-meta">${done}/${total}</div>
                  </div>
                  ${bar}
                  <div class="subs">${subHtml}</div>
                </div>`;
              }).join("")}
            </div>
          </div>
        </div>
      </div>
    `;
    container.appendChild(panel);
  });

  // toggles
  document.querySelectorAll("[data-toggle]").forEach(btn=>{
    btn.addEventListener("click", (e)=>{
      const pid = Number(e.currentTarget.getAttribute("data-toggle"));
      togglePanel(pid);
    });
  });
  // checkbox listeners
  document.querySelectorAll('input[type="checkbox"][data-p]').forEach(cb=>{
    cb.addEventListener("change", onCheck);
  });
}

        <div class="subgrid">
          <div class="card">
            <h3>Timeline</h3>
            <div class="timeline">
              ${p.timeline.map(t=>`
                <div class="step">
                  <div class="dot"></div>
                  <div class="txt">${t}</div>
                </div>`).join("")}
            </div>
          </div>
          <div class="card">
            <h3>Checklist</h3>
            <div class="list" id="list-${p.id}">
              ${p.tasks.map((t,i)=>{
                const checked = (state[p.id]?.[i]) ? "checked" : "";
                return `<label class="chk">
                  <input type="checkbox" data-p="${p.id}" data-i="${i}" ${checked}/>
                  <span>${t}</span>
                </label>`;
              }).join("")}
            </div>
          </div>
        </div>
      </div>
    `;
    container.appendChild(panel);
  });

  document.querySelectorAll("[data-toggle]").forEach(btn=>{
    btn.addEventListener("click", (e)=>{
      const pid = Number(e.currentTarget.getAttribute("data-toggle"));
      togglePanel(pid);
    });
  });

  document.querySelectorAll('input[type="checkbox"][data-p]').forEach(cb=>{
    cb.addEventListener("change", onCheck);
  });
}

function openPanel(pid, exclusive=false){
  const p = document.getElementById(`panel-${pid}`);
  if(!p) return;
  if(exclusive){
    document.querySelectorAll(".panel").forEach(el=> el.classList.remove("open"));
  }
  p.classList.add("open");
}
function togglePanel(pid){
  const p = document.getElementById(`panel-${pid}`);
  if(!p) return;
  p.classList.toggle("open");
}


function onCheck(e){
  const pid = Number(e.target.getAttribute("data-p"));
  const tlabel = e.target.getAttribute("data-task");
  const idx = Number(e.target.getAttribute("data-i"));
  state[pid] = state[pid] || {};
  const phase = PHASES.find(p=>p.id===pid);
  const task = phase.tasks.find(t=>t.label===tlabel);
  const len = (task.subs && task.subs.length) ? task.subs.length : 1;
  const arr = state[pid][tlabel] || Array(len).fill(false);
  arr[idx] = e.target.checked;
  state[pid][tlabel] = arr;
  save();
  renderBubbles();
  renderPanels();
  openPanel(pid);
}


document.getElementById("resetBtn").addEventListener("click", ()=>{
  localStorage.removeItem(KEY);
  Object.keys(state).forEach(k=> delete state[k]);
  renderBubbles(); renderPanels();
});


renderBubbles();
renderPanels();
openPanel(1);

document.addEventListener('click', (e)=>{
  const m = document.querySelector('details.header-menu');
  if(!m) return;
  if(!m.contains(e.target)) m.open = false;
});

function setupSideDrawer(){
  const btn = document.querySelector('.side-toggle');
  if(!btn) return;
  btn.addEventListener('click', ()=>{
    document.body.classList.toggle('side-open');
    const open = document.body.classList.contains('side-open');
    const aside = document.querySelector('.side-drawer');
    if(aside) aside.setAttribute('aria-hidden', String(!open));
  });
  // close on ESC or outside click
  document.addEventListener('keydown', (e)=>{
    if(e.key==='Escape') document.body.classList.remove('side-open');
  });
  document.addEventListener('click', (e)=>{
    const aside = document.querySelector('.side-drawer');
    const toggle = document.querySelector('.side-toggle');
    if(!aside) return;
    if(document.body.classList.contains('side-open')){
      if(!aside.contains(e.target) && !toggle.contains(e.target)){
        document.body.classList.remove('side-open');
      }
    }
  });
}
setupSideDrawer();

</script>

</body>
</html>
